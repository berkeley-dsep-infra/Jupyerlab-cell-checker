{"version":3,"file":"lib_index_js.88b12009760ff267e87b.js","mappings":";;;;;;;;;;;;;;;;AAAkC;AAElC,gCAAgC;AAChC,MAAM,cAAc,GAAG;IACrB,KAAK,EAAE,EAAE;IACT,MAAM,EAAE,EAAE;IACV,KAAK,EAAE,EAAE;IACT,MAAM,EAAE,EAAE;IACV,KAAK,EAAE,GAAG;IACV,OAAO,EAAE,CAAC;IACV,KAAK,EAAE,SAAS;IAChB,SAAS,EAAE,aAAa;IACxB,KAAK,EAAE,CAAC;IACR,MAAM,EAAE,CAAC;IACT,SAAS,EAAE,yBAAyB;IACpC,QAAQ,EAAE,UAAU,EAAE,sBAAsB;CAC7C,CAAC;AAEK,SAAS,aAAa,CAAC,MAAmB;IAC/C,MAAM,OAAO,GAAG,IAAI,4CAAO,CAAC,cAAc,CAAC,CAAC;IAC5C,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;IACrB,OAAO,OAAO,CAAC;AACjB,CAAC;AAEM,SAAS,WAAW,CAAC,OAAuB;IACjD,IAAI,OAAO;QAAE,OAAO,CAAC,IAAI,EAAE,CAAC;AAC9B,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACtBgC;AAEgD;AAC5B;AAEZ;AACW;AAGpD,uCAAuC;AACF;AACX;AACwC;AAGlE,SAAS,iBAAiB,CAAC,aAAqB,EAAE,aAAqB;IAErE,oCAAoC;IACpC,SAAS,QAAQ,CAAC,GAAW;QAC3B,MAAM,CAAC,GAAG,QAAQ,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;QACxC,MAAM,CAAC,GAAG,QAAQ,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;QACxC,MAAM,CAAC,GAAG,QAAQ,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;QACxC,OAAO,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;IACrB,CAAC;IAED,6CAA6C;IAC7C,SAAS,kBAAkB,CAAC,GAAwC;QAClE,MAAM,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,UAAU,CAAC;YAC7C,CAAC,IAAI,GAAG,CAAC;YACT,OAAO,CAAC,IAAI,OAAO,CAAC,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,GAAG,KAAK,EAAE,GAAG,CAAC,CAAC;QACvE,CAAC,CAAC,CAAC;QACH,OAAO,CAAC,CAAC,CAAC,CAAC,GAAG,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,MAAM,CAAC;IACvD,CAAC;IAED,SAAS,gBAAgB,CAAC,MAAc,EAAE,MAAc;QACtD,MAAM,IAAI,GAAG,QAAQ,CAAC,MAAM,CAAC,CAAC;QAC9B,MAAM,IAAI,GAAG,QAAQ,CAAC,MAAM,CAAC,CAAC;QAC9B,MAAM,EAAE,GAAG,kBAAkB,CAAC,IAAI,CAAC,CAAC;QACpC,MAAM,EAAE,GAAG,kBAAkB,CAAC,IAAI,CAAC,CAAC;QACpC,MAAM,OAAO,GAAG,IAAI,CAAC,GAAG,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;QACjC,MAAM,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;QAChC,OAAO,CAAC,OAAO,GAAG,IAAI,CAAC,GAAG,CAAC,MAAM,GAAG,IAAI,CAAC,CAAC;IAC5C,CAAC;IAED,IAAG;QACD,MAAM,QAAQ,GAAG,gBAAgB,CAAC,aAAa,EAAE,aAAa,CAAC,CAAC;QAChE,OAAO,QAAQ,CAAC;KACjB;IAAC,WAAM;QACN,OAAO,EAAE,CAAC;KACX;AACH,CAAC;AAED,KAAK,UAAU,kBAAkB,CAAC,SAAoB,EAAE,SAAiB,EAAE,KAAa;IACtF,MAAM,MAAM,GAAG,MAAM,6DAAmB,CAAC,SAAS,EAAE,KAAK,EAAE,EAAE,CAAC,CAAC;IAC/D,MAAM,KAAK,GAAG,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC;IAChC,IAAI,KAAK,CAAC,MAAM,KAAK,CAAC,EAAE;QACpB,MAAM,IAAI,KAAK,CAAC,4BAA4B,CAAC,CAAC;KACjD;IACD,IAAI,WAAW,GAAG,EAAE,CAAC;IACrB,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE;QACnB,gCAAgC;QAChC,IAAG,IAAI,CAAC,UAAU,IAAI,EAAE,IAAI,IAAI,CAAC,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,IAAI,IAAI,GAAG,EAAC;YAC3H,MAAM,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC;YAEvB,MAAM,UAAU,GAA8B,EAAE,CAAC;YACjD,MAAM,IAAI,GAAG,SAAS,CAAC,IAAI,CAAC;YAC5B,MAAM,KAAK,GAAG,SAAS,CAAC,KAAK,CAAC;YAE9B,kFAAkF;YAClF,KAAK,IAAI,CAAC,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC,IAAI,IAAI,CAAC,EAAE,EAAE,CAAC,EAAE,EAAE;gBACrC,KAAK,IAAI,CAAC,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC,IAAI,IAAI,CAAC,EAAE,EAAE,CAAC,EAAE,EAAE;oBACrC,MAAM,KAAK,GAAG,CAAC,CAAC,GAAG,KAAK,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC;oBAClC,MAAM,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,GAAG,EAAE,CAAC,EAAE,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC,EAAE;oBAC9E,MAAM,QAAQ,GAAG,GAAG,GAAG,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,GAAC,KAAK,CAAC,GAAC,KAAK,IAAI,EAAE,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,GAAC,KAAK,CAAC,GAAC,KAAK,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,GAAC,KAAK,CAAC,GAAC,KAAK,CAAC,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,WAAW,EAAE;oBACzK,UAAU,CAAC,QAAQ,CAAC,GAAG,CAAC,UAAU,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC;iBAC1D;aACJ;YAED,IAAI,KAAK,GAAG,MAAM,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,aAAa;YACvF,IAAI,KAAK,GAAG,MAAM,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,iCAAiC;YAE3G,0BAA0B;YAE1B,IAAI,QAAQ,GAAG,iBAAiB,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC;YAC/C,iHAAiH;YAEjH,yDAAyD;YACzD,IAAG,QAAQ,GAAG,WAAW,EAAC;gBACxB,WAAW,GAAG,QAAQ,CAAC;aACxB;SACF;IACH,CAAC,CAAC,CAAC;IAEH,OAAO,WAAW,CAAC;AACrB,CAAC;AAED,KAAK,UAAU,eAAe,CAAC,QAAgB;IAC7C,OAAO,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM,EAAE,EAAE;QACrC,MAAM,GAAG,GAAG,IAAI,KAAK,EAAE,CAAC;QACxB,GAAG,CAAC,WAAW,GAAG,WAAW,CAAC,CAAC,wDAAwD;QAEvF,yCAAyC;QACzC,IAAI;YACF,IAAI,GAAG,CAAC,QAAQ,CAAC,CAAC;YAClB,GAAG,CAAC,GAAG,GAAG,QAAQ,CAAC;SACpB;QAAC,OAAO,CAAC,EAAE;YACV,MAAM,OAAO,GAAG,QAAQ,CAAC,QAAQ,CAAC,MAAM,CAAC;YACzC,IAAI,SAAS,GAAG,GAAG,OAAO,UAAU,QAAQ,EAAE;YAC9C,GAAG,CAAC,GAAG,GAAG,SAAS,CAAC;SACrB;QAED,IAAG;YACD,GAAG,CAAC,MAAM,GAAG,KAAK,IAAI,EAAE;gBACtB,MAAM,MAAM,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;gBAChD,MAAM,CAAC,KAAK,GAAG,GAAG,CAAC,KAAK,CAAC;gBACzB,MAAM,CAAC,MAAM,GAAG,GAAG,CAAC,MAAM,CAAC;gBAC3B,MAAM,GAAG,GAAG,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;gBACpC,IAAI,CAAC,GAAG,EAAE;oBACR,OAAO,CAAC,qBAAqB,CAAC;oBAC9B,OAAO;iBACR;gBACD,GAAG,CAAC,SAAS,CAAC,GAAG,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;gBACzB,IAAI,SAAS,GAAG,GAAG,CAAC,YAAY,CAAC,CAAC,EAAE,CAAC,EAAE,MAAM,CAAC,KAAK,EAAE,MAAM,CAAC,MAAM,CAAC,CAAC;gBACpE,IAAI,YAAY,CAAC;gBACjB,IAAI;oBACF,YAAY,GAAG,MAAM,kBAAkB,CAAC,SAAS,EAAE,GAAG,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC;iBACjE;gBAAC,OAAO,KAAK,EAAE;oBACd,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;oBACrB,YAAY,GAAG,EAAE,CAAC,CAAC,uCAAuC;iBAC3D;gBAED,OAAO,CAAC,GAAG,YAAY,aAAa,YAAY,CAAC,OAAO,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC;YACnE,CAAC,CAAC;SACH;QAAC,WAAM;YACN,OAAO,CAAC,qBAAqB,CAAC,CAAC;SAChC;QAGD,sDAAsD;IACxD,CAAC,CAAC,CAAC;AACL,CAAC;AAED,SAAS,oBAAoB,CAAC,SAAiB,EAAE,YAAoB;IACnE,OAAO,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM,EAAE,EAAE;QACrC,MAAM,GAAG,GAAG,IAAI,KAAK,EAAE,CAAC;QACxB,GAAG,CAAC,WAAW,GAAG,WAAW,CAAC,CAAC,mCAAmC;QAClE,yCAAyC;QACzC,IAAI;YACF,IAAI,GAAG,CAAC,SAAS,CAAC,CAAC;YACnB,GAAG,CAAC,GAAG,GAAG,SAAS,CAAC;SACrB;QAAC,OAAO,CAAC,EAAE;YACV,MAAM,OAAO,GAAG,QAAQ,CAAC,QAAQ,CAAC,MAAM,CAAC;YACzC,IAAI,SAAS,GAAG,GAAG,OAAO,UAAU,SAAS,EAAE;YAC/C,GAAG,CAAC,GAAG,GAAG,SAAS,CAAC;SACrB;QACD,IAAG;YACD,GAAG,CAAC,MAAM,GAAG,GAAG,EAAE;gBAChB,MAAM,MAAM,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;gBAChD,MAAM,CAAC,KAAK,GAAG,GAAG,CAAC,KAAK,CAAC;gBACzB,MAAM,CAAC,MAAM,GAAG,GAAG,CAAC,MAAM,CAAC;gBAE3B,MAAM,OAAO,GAAG,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;gBACxC,IAAI,CAAC,OAAO,EAAE;oBACZ,+CAA+C;oBAC/C,OAAO,CAAC,EAAE,GAAG,SAAS,CAAC,CAAC;oBACxB,OAAO;iBACR;gBAED,OAAO,CAAC,SAAS,CAAC,GAAG,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;gBAC7B,MAAM,SAAS,GAAG,OAAO,CAAC,YAAY,CAAC,CAAC,EAAE,CAAC,EAAE,MAAM,CAAC,KAAK,EAAE,MAAM,CAAC,MAAM,CAAC,CAAC;gBAC1E,MAAM,IAAI,GAAG,SAAS,CAAC,IAAI,CAAC;gBAE5B,IAAI,qBAAqB,GAAG,CAAC,CAAC;gBAC9B,MAAM,WAAW,GAAG,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC;gBAEpC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,IAAI,CAAC,EAAE;oBACvC,gEAAgE;oBAChE,IAAI,IAAI,CAAC,CAAC,CAAC,GAAG,GAAG,EAAE;wBACjB,qBAAqB,EAAE,CAAC;qBACzB;iBACF;gBAED,2CAA2C;gBAC3C,MAAM,sBAAsB,GAAG,CAAC,qBAAqB,GAAG,WAAW,CAAC,GAAG,GAAG,CAAC;gBAC3E,OAAO,CAAC,CAAC,EAAE,GAAG,sBAAsB,GAAC,EAAE,CAAC,GAAG,SAAS,CAAC,CAAC;YACxD,CAAC,CAAC;SACH;QAAC,WAAM;YACN,OAAO,CAAC,GAAG,CAAC,8BAA8B,CAAC,CAAC;YAC5C,OAAO,CAAC,EAAE,GAAG,SAAS,CAAC,CAAC;SACzB;IACH,CAAC,CAAC,CAAC;AACL,CAAC;AAED,KAAK,UAAU,uBAAuB,CAAC,UAAkB,EAAE,MAAc,EAAE,SAAiB;IAC1F,kEAAkE;IAClE,OAAO,IAAI,OAAO,CAAC,KAAK,EAAE,OAAO,EAAE,MAAM,EAAE,EAAE;QAC3C,MAAM,MAAM,GAAG,IAAI,SAAS,EAAE,CAAC;QAC/B,MAAM,GAAG,GAAG,MAAM,CAAC,eAAe,CAAC,UAAU,EAAE,WAAW,CAAC,CAAC;QAC5D,MAAM,MAAM,GAAG,GAAG,CAAC,gBAAgB,CAAC,KAAK,CAAC,CAAC;QAE3C,IAAI,kBAAkB,GAAa,EAAE,CAAC;QACtC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YACtC,MAAM,GAAG,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;YACtB,IAAI,CAAC,GAAG,CAAC,YAAY,CAAC,KAAK,CAAC,IAAI,GAAG,CAAC,YAAY,CAAC,KAAK,CAAC,KAAK,EAAE,EAAE;gBAC9D,kBAAkB,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;aAChC;YAED,kEAAkE;SACnE;QAED,MAAM,oBAAoB,GAAG,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC,CAAC,GAAqB,EAAE,EAAE,CAAC,oBAAoB,CAAC,GAAG,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC,CAAC;QACtH,MAAM,YAAY,GAAG,MAAM,OAAO,CAAC,GAAG,CAAC,oBAAoB,CAAC,CAAC;QAE7D,MAAM,qBAAqB,GAAG,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC,CAAC,GAAqB,EAAE,EAAE,CAAC,eAAe,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC;QAC1G,MAAM,aAAa,GAAI,MAAM,OAAO,CAAC,GAAG,CAAC,qBAAqB,CAAC,CAAC;QAEhE,kBAAkB,GAAG,CAAC,GAAG,kBAAkB,EAAE,GAAG,YAAY,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,GAAG,aAAa,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC;QAExG,OAAO,CAAC,kBAAkB,CAAC,CAAC;IAC9B,CAAC,CAAC,CAAC;AACL,CAAC;AAED,KAAK,UAAU,qBAAqB,CAAC,QAAgB,EAAE,MAAc,EAAE,SAAiB;IACtF,sEAAsE;IACtE,OAAO,IAAI,OAAO,CAAC,KAAK,EAAE,OAAO,EAAE,MAAM,EAAE,EAAE;QAC3C,MAAM,eAAe,GAAG,mBAAmB,CAAC;QAC5C,MAAM,cAAc,GAAG,oBAAoB,CAAC;QAC5C,IAAI,kBAAkB,GAAa,EAAE,CAAC;QAEtC,IAAI,KAA6B,CAAC;QAClC,MAAM,SAAS,GAAa,EAAE,CAAC;QAE/B,OAAO,CAAC,KAAK,GAAG,cAAc,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,KAAK,IAAI,EAAE;YACrD,MAAM,QAAQ,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC;YAC1B,IAAI,QAAQ,EAAE;gBACV,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;aAC5B;SACJ;QAED,IAAI,eAAe,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAC;YACjC,kBAAkB,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;SAChC;QAGD,MAAM,oBAAoB,GAAG,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,GAAG,CAAC,CAAC,CAAS,EAAE,EAAE,CAAC,oBAAoB,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC;QACvG,MAAM,YAAY,GAAG,MAAM,OAAO,CAAC,GAAG,CAAC,oBAAoB,CAAC,CAAC;QAE7D,MAAM,qBAAqB,GAAG,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,GAAG,CAAC,CAAC,CAAS,EAAE,EAAE,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,CAAC;QAC3F,MAAM,aAAa,GAAG,MAAM,OAAO,CAAC,GAAG,CAAC,qBAAqB,CAAC,CAAC;QAE/D,kBAAkB,GAAG,CAAC,GAAG,kBAAkB,EAAE,GAAG,YAAY,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,GAAG,aAAa,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC;QAExG,OAAO,CAAC,kBAAkB,CAAC,CAAC;IAC9B,CAAC,CAAC,CAAC;AACL,CAAC;AAED,KAAK,UAAU,qCAAqC,CAAC,IAAU,EAAE,MAAc;IAC7E,6EAA6E;IAC7E,IAAG;QACD,IAAG,IAAI,CAAC,KAAK,CAAC,IAAI,IAAI,UAAU,EAAC;YAC/B,IAAI,GAAG,IAAoB,CAAC;YAC5B,MAAM,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC;YACvD,MAAM,aAAa,GAAG,MAAM,qBAAqB,CAAC,QAAQ,EAAE,MAAM,EAAE,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,gBAAgB,CAAC,cAAc,CAAC,CAAC,CAAC;YAC1H,MAAM,SAAS,GAAG,MAAM,uBAAuB,CAAC,QAAQ,EAAE,MAAM,EAAE,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,gBAAgB,CAAC,cAAc,CAAC,CAAC,CAAC;YACxH,IAAI,MAAM,GAAG,SAAS,CAAC,MAAM,CAAC,aAAa,CAAC;YAC5C,OAAO,MAAM,CAAC;SACf;aAAM;YACL,OAAO,EAAE,CAAC;SACX;KACF;IAAC,WAAM;QACN,OAAO,EAAE,CAAC;KACX;AAEH,CAAC;AAED,KAAK,UAAU,qCAAqC,CAAC,IAAU,EAAE,MAAc;IAC7E,gDAAgD;IAChD,0DAA0D;IAC1D,gDAAgD;IAChD,IAAG;QACD,IAAG,IAAI,CAAC,KAAK,CAAC,IAAI,IAAI,MAAM,EAAC;YAC3B,MAAM,QAAQ,GAAG,IAAgB,CAAC;YAClC,MAAM,UAAU,GAAG,QAAQ,CAAC,UAAU,CAAC,IAAI,CAAC,SAAS,CAAC;YAEtD,MAAM,0BAA0B,GAAG,MAAM,uBAAuB,CAAC,UAAU,EAAE,MAAM,EAAE,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,gBAAgB,CAAC,cAAc,CAAC,CAAC,CAAC;YAC3I,OAAO,0BAA0B,CAAC;SACnC;aAAM;YACL,OAAO,EAAE,CAAC;SACX;KACF;IAAC,WAAM;QACN,OAAO,EAAE,CAAC;KACX;AAEH,CAAC;AAED,KAAK,UAAU,aAAa,CAAC,eAAyB,EAAE,WAAwB,EAAE,SAAwB,EAAE,MAAc,EAAE,SAAkB;IAC5I,MAAM,WAAW,GAAkE,EAAE,CAAC;IAEtF,eAAe,CAAC,OAAO,CAAC,OAAO,CAAC,KAAK,EAAC,IAAI,EAAC,EAAE;QAC3C,IAAI,SAAS,EAAE,EAAC;YACd,IAAG,SAAS,EAAC;gBACX,gDAAgD;gBAChD,kDAAkD;gBAClD,oBAAoB,CAAC,WAAW,EAAE,IAAI,EAAE,EAAE,CAAC,CAAC;gBAC5C,MAAM,YAAY,GAAG,MAAM,qCAAqC,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;gBAC/E,MAAM,uBAAuB,GAAG,MAAM,qCAAqC,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;gBAC1F,IAAI,MAAM,GAAG,YAAY,CAAC,MAAM,CAAC,uBAAuB,CAAC,CAAC;gBAC1D,oBAAoB,CAAC,WAAW,EAAE,IAAI,EAAE,MAAM,CAAC,CAAC;aACjD;YAED,0BAA0B;YAC1B,IAAI,IAAI,CAAC,KAAK,CAAC,IAAI,KAAK,UAAU,EAAE;gBAClC,MAAM,KAAK,GAAG,IAAoB,CAAC;gBAEnC,MAAM,QAAQ,GAAG,KAAK,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC;gBACxD,MAAM,oBAAoB,GAAG,kBAAkB,CAAC;gBAChD,MAAM,gBAAgB,GAAG,wBAAwB,CAAC;gBAElD,IAAI,KAAK,CAAC;gBACV,OAAO,CAAC,KAAK,GAAG,oBAAoB,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,KAAK,IAAI,EAAE;oBAC7D,MAAM,KAAK,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAE,+CAA+C;oBAC/E,WAAW,CAAC,IAAI,CAAC,EAAC,YAAY,EAAE,KAAK,EAAE,OAAO,EAAE,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,EAAE,EAAE,MAAM,EAAE,KAAK,EAAC,CAAC,CAAC;iBACvF;gBAED,OAAO,CAAC,KAAK,GAAG,gBAAgB,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,KAAK,IAAI,EAAE;oBACzD,MAAM,KAAK,GAAG,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAE,8CAA8C;oBACjF,WAAW,CAAC,IAAI,CAAC,EAAC,YAAY,EAAE,KAAK,EAAE,OAAO,EAAE,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,EAAE,EAAE,MAAM,EAAE,KAAK,EAAE,CAAC,CAAC;iBACxF;aACF;YAED,IAAI,WAAW,CAAC,MAAM,GAAG,CAAC,EAAC;gBACzB,IAAI,aAAa,GAAG,WAAW,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC;gBAChD,IAAI,YAAY,GAAG,aAAa,CAAC;gBACjC,MAAM,MAAM,GAA6D,EAAE,CAAC;gBAE5E,WAAW,CAAC,OAAO,CAAC,CAAC,OAAO,EAAE,KAAK,EAAE,EAAE;oBACrC,IAAI,OAAO,CAAC,YAAY,GAAG,aAAa,GAAG,CAAC,EAAE;wBAC5C,yDAAyD;wBACzD,MAAM,CAAC,IAAI,CAAC;4BACV,MAAM,EAAE,OAAO,CAAC,MAAM;4BACtB,OAAO,EAAE,IAAI,OAAO,CAAC,YAAY,EAAE;4BACnC,QAAQ,EAAE,IAAI,aAAa,GAAG,CAAC,EAAE;yBAClC,CAAC,CAAC;qBACJ;yBAAM,IAAI,OAAO,CAAC,YAAY,GAAG,YAAY,EAAC;wBAC7C,oDAAoD;wBACpD,MAAM,CAAC,IAAI,CAAC;4BACV,MAAM,EAAE,OAAO,CAAC,MAAM;4BACtB,OAAO,EAAE,IAAI,OAAO,CAAC,YAAY,EAAE;4BACnC,QAAQ,EAAE,IAAI,YAAY,EAAE;yBAC7B,CAAC,CAAC;qBACJ;oBAED,aAAa,GAAG,OAAO,CAAC,YAAY,CAAC;gBACvC,CAAC,CAAC,CAAC;gBAEH,MAAM,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE;oBACjB,2FAA2F;oBAC3F,oBAAoB,CAAC,WAAW,EAAE,CAAC,CAAC,MAAM,EAAE,EAAE,CAAC;oBAC/C,oBAAoB,CAAC,WAAW,EAAE,CAAC,CAAC,MAAM,EAAE,CAAC,UAAU,GAAG,CAAC,CAAC,OAAO,GAAG,GAAG,GAAG,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;gBAC3F,CAAC,CAAC,CAAC;aACJ;SACF;aAAM;YACL,oBAAoB,CAAC,WAAW,EAAE,IAAI,EAAE,EAAE,CAAC,CAAC;SAC7C;IACH,CAAC,CAAC,CAAC;IACH,WAAW,CAAC,oBAAoB,EAAE,CAAC;AACrC,CAAC;AAED,KAAK,UAAU,4BAA4B,CAAC,eAAyB,EAAE,WAAwB,EAAE,IAAU,EAAE,SAAwB,EAAE,MAAc;IACnJ,2DAA2D;IAC3D,IAAI,CAAC,KAAK,CAAC,cAAc,CAAC,OAAO,CAAC,KAAK,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE;QACvD,8BAA8B;QAC9B,MAAM,aAAa,CAAC,eAAe,EAAE,WAAW,EAAE,SAAS,EAAE,MAAM,EAAE,KAAK,CAAC,CAAC;QAE5E,sDAAsD;QACtD,oBAAoB,CAAC,WAAW,EAAE,IAAI,EAAE,EAAE,CAAC,CAAC;QAC5C,MAAM,YAAY,GAAG,MAAM,qCAAqC,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;QAC/E,MAAM,uBAAuB,GAAG,MAAM,qCAAqC,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;QAC1F,IAAI,MAAM,GAAG,YAAY,CAAC,MAAM,CAAC,uBAAuB,CAAC,CAAC;QAC1D,oBAAoB,CAAC,WAAW,EAAE,IAAI,EAAE,MAAM,CAAC,CAAC;IAClD,CAAC,CAAC,CAAC;AAEL,CAAC;AAED,SAAS,oBAAoB,CAAC,WAAwB,EAAE,IAAU,EAAE,UAAoB;;IACtF,IAAI,WAAmB,CAAC;IACxB,IAAI;QACF,WAAW,GAAG,0BAA0B,GAAG,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC;KAC1D;IAAC,WAAM;QACN,OAAO;KACR;IAED,WAAW,CAAC,UAAU,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC;IAGtC,qEAAqE;IACrE,yCAAyC;IACzC,OAAM,QAAQ,CAAC,cAAc,CAAC,WAAW,CAAC,EAAC;QACzC,cAAQ,CAAC,cAAc,CAAC,WAAW,CAAC,0CAAE,MAAM,EAAE,CAAC;KAChD;IAED,IAAI,UAAU,GAAG,KAAK,CAAC;IAEvB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,UAAU,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;QAC1C,iCAAiC;QACjC,IAAI,UAAU,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,EAAC,CAAC,CAAC,IAAI,SAAS,EAAE,EAAE,eAAe;YAC1D,WAAW,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,EAAE,4BAA4B,GAAG,UAAU,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,EAAE,EAAE,EAAE,CAAC,GAAG,QAAQ,GAAG,UAAU,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC,EAAE,SAAS,CAAC,CAAC;YAClJ,UAAU,GAAG,IAAI,CAAC;SACnB;aAAM,IAAG,UAAU,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,UAAU,EAAC;YAClD,IAAI,KAAK,GAAG,MAAM,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YAChD,IAAI,KAAK,GAAG,GAAG,EAAE;gBACf,WAAW,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,EAAE,4BAA4B,GAAG,UAAU,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE,UAAU,CAAC,CAAC;gBAC3G,UAAU,GAAG,IAAI,CAAC;aACnB;SACF;aAAM,IAAI,UAAU,CAAC,CAAC,CAAC,IAAI,KAAK,EAAE;YACjC,WAAW,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,EAAE,6BAA6B,EAAE,KAAK,CAAC,CAAC;YACzE,UAAU,GAAG,IAAI,CAAC;SACnB;aAAM;YACL,IAAI,KAAK,GAAG,MAAM,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YAChD,IAAI,KAAK,GAAG,CAAC,EAAE;gBACb,WAAW,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,EAAE,sCAAsC,GAAG,CAAC,CAAC,EAAE,GAAC,KAAK,CAAC,GAAC,EAAE,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,IAAI,EAAE,cAAc,CAAC,CAAC;gBAC/H,UAAU,GAAG,IAAI,CAAC;aACnB;SACF;KACF;IAGD,IAAI,UAAU,EAAE;QACd,+BAA+B;QAC/B,IAAI,CAAC,QAAQ,CAAC,cAAc,CAAC,WAAW,CAAC,EAAE;YACzC,IAAI,SAAS,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;YAC9C,SAAS,CAAC,EAAE,GAAG,WAAW,CAAC;YAC3B,SAAS,CAAC,KAAK,CAAC,QAAQ,GAAG,UAAU,CAAC;YACtC,SAAS,CAAC,KAAK,CAAC,GAAG,GAAG,MAAM,CAAC;YAC7B,SAAS,CAAC,KAAK,CAAC,IAAI,GAAG,MAAM,CAAC;YAC9B,SAAS,CAAC,KAAK,CAAC,KAAK,GAAG,MAAM,CAAC;YAC/B,SAAS,CAAC,KAAK,CAAC,MAAM,GAAG,MAAM,CAAC;YAChC,SAAS,CAAC,KAAK,CAAC,YAAY,GAAG,KAAK,CAAC;YACrC,SAAS,CAAC,KAAK,CAAC,eAAe,GAAG,SAAS,CAAC;YAC5C,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC,CAAC;SAClC;KACF;SAAM;QACL,mDAAmD;QACnD,IAAI,SAAS,GAAG,QAAQ,CAAC,cAAc,CAAC,WAAW,CAAC,CAAC;QACrD,SAAS,aAAT,SAAS,uBAAT,SAAS,CAAE,MAAM,EAAE,CAAC;QACpB,WAAW,CAAC,UAAU,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC;KACvC;IACD,sCAAsC;AACxC,CAAC;AAED,KAAK,UAAU,gBAAgB,CAAC,QAAmB,EAAE,WAAwB,EAAE,aAA4B,EAAE,SAAwB,EAAE,aAAyB,EAAE,MAAc;IAC9K,MAAM,MAAM,GAAG,IAAI,+DAAa,CAAC;QAC/B,KAAK,EAAE,iBAAiB;QACxB,OAAO,EAAE,GAAG,EAAE;YACZ,aAAa,EAAE,CAAC;YAChB,IAAG,SAAS,EAAE,EAAC;gBACb,QAAQ,CAAC,YAAY,CAAC,aAAa,CAAC,CAAC;aACtC;iBAAM;gBACL,QAAQ,CAAC,aAAa,EAAE,CAAC;aAC1B;YACD,gCAAgC;YAChC,aAAa,CAAC,aAAa,CAAC,OAAO,EAAE,WAAW,EAAE,SAAS,EAAE,MAAM,EAAE,IAAI,CAAC,CAAC;QAC7E,CAAC;QAED,OAAO,EAAE,uBAAuB;KACjC,CAAC,CAAC;IAEH,MAAM,CAAC,EAAE,GAAG,uBAAuB,CAAC;IACpC,aAAa,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC,EAAE,cAAc,EAAE,MAAM,CAAC,CAAC;IAE5D,IAAI,IAAI,GAAG,QAAQ,CAAC,cAAc,CAAC,uBAAuB,CAAC,CAAC;IAC5D,IAAK,CAAC,KAAK,CAAC,eAAe,GAAG,OAAO,CAAC;IAEtC,OAAO,MAAM,CAAC;AAChB,CAAC;AAED,KAAK,UAAU,kBAAkB,CAAC,QAAgB;IAChD,MAAM,QAAQ,GAAG,MAAM,gDAAS,CAAC,QAAQ,EAAE,EAAE,YAAY,EAAE,MAAM,EAAE,CAAC,CAAC;IACrE,MAAM,SAAS,GAAG,QAAQ,CAAC,IAAI,CAAC;IAEhC,kDAAkD;IAClD,MAAM,YAAY,GAAG,MAAM,IAAI,OAAO,CAAS,CAAC,OAAO,EAAE,MAAM,EAAE,EAAE;QAC/D,MAAM,MAAM,GAAG,IAAI,UAAU,EAAE,CAAC;QAChC,MAAM,CAAC,SAAS,GAAG,GAAG,EAAE;YACpB,MAAM,MAAM,GAAG,MAAM,CAAC,MAAgB,CAAC;YACvC,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,kEAAkE;QACrG,CAAC,CAAC;QACF,MAAM,CAAC,OAAO,GAAG,MAAM,CAAC;QACxB,MAAM,CAAC,aAAa,CAAC,SAAS,CAAC,CAAC;IACpC,CAAC,CAAC,CAAC;IAEH,OAAO,YAAY,CAAC;AACtB,CAAC;AAED,KAAK,UAAU,gBAAgB,CAAC,SAAiB;IAC/C,IAAI;QACA,IAAI,YAAY,GAAG,SAAS,CAAC,UAAU,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,MAAM,kBAAkB,CAAC,SAAS,CAAC,CAAC;QACtH,MAAM,OAAO,GAAG;YACZ,KAAK,EAAE,OAAO;YACd,sCAAsC;YACtC,MAAM,EAAE,4FAA4F;YACpG,MAAM,EAAE,KAAK;YACb,MAAM,EAAE,CAAC,YAAY,CAAC;SACzB,CAAC;QACF,OAAO,CAAC,GAAG,CAAC,yBAAyB,CAAC,CAAC;QACvC,UAAU;QACV,MAAM,QAAQ,GAAG,MAAM,iDAAU,CAAC,iFAAiF,EAAE,OAAO,EAAE;YAC1H,OAAO,EAAE,EAAE,cAAc,EAAE,kBAAkB,EAAE;SAClD,CAAC,CAAC;QAEH,oBAAoB;QACpB,sFAAsF;QACtF,sDAAsD;QACtD,MAAM;QAEN,OAAO,CAAC,GAAG,CAAC,YAAY,EAAE,QAAQ,CAAC,CAAC;QACpC,IAAI,MAAM,GAAG,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,GAAG,sDAAsD;QACnG,OAAO,MAAM,CAAC;KACjB;IAAC,OAAO,KAAK,EAAE;QACZ,OAAO,CAAC,KAAK,CAAC,kCAAkC,EAAE,KAAK,CAAC,CAAC;QACzD,OAAO,qCAAqC,CAAC;KAChD;AACH,CAAC;AAAA,CAAC;AAEF,MAAM,MAAM,GAAgC;IAC1C,EAAE,EAAE,iCAAiC;IACrC,SAAS,EAAE,IAAI;IACf,QAAQ,EAAE,CAAC,kEAAgB,EAAE,8DAAS,CAAC;IACvC,QAAQ,EAAE,CAAC,GAAoB,EAAE,eAAiC,EAAE,QAAmB,EAAE,EAAE;QACzF,OAAO,CAAC,GAAG,CAAC,6DAA6D,CAAC,CAAC;QAE3E,IAAI,SAAS,GAAG,IAAI,CAAC;QACrB,yCAAyC;QACzC,MAAM,aAAa,GAAG,GAAG,EAAE;YACzB,SAAS,GAAG,CAAC,SAAS,CAAC;YACvB,OAAO,CAAC,GAAG,CAAC,wBAAwB,SAAS,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,UAAU,GAAG,CAAC,CAAC;QAC7E,CAAC,CAAC;QAEF,sBAAsB;QACtB,MAAM,iBAAiB,GAAG,IAAI,8DAAO,CAAC;YACpC,IAAI,EAAE,eAAe;YACrB,MAAM,EAAE,8jCAA8jC;SACvkC,CAAC,CAAC;QAEH,MAAM,WAAW,GAAgB,IAAI,WAAW,CAAC,eAAe,CAAC,CAAC;QAClE,WAAW,CAAC,EAAE,GAAG,aAAa,CAAC;QAC/B,WAAW,CAAC,KAAK,CAAC,IAAI,GAAG,iBAAiB,CAAC;QAC3C,QAAQ,CAAC,GAAG,CAAC,WAAW,EAAE,OAAO,CAAC,CAAC;QACnC,QAAQ,CAAC,YAAY,CAAC,aAAa,CAAC,CAAC;QAErC,eAAe,CAAC,cAAc,CAAC,OAAO,CAAC,CAAC,MAAM,EAAE,aAAa,EAAE,EAAE;YAC/D,IAAI,CAAC,aAAa;gBAAE,OAAO;YAE3B,aAAa,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,EAAE;gBACpC,MAAM,EAAE,OAAO,EAAE,GAAG,aAAa,CAAC;gBAElC,2DAA2D;gBAC3D,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,KAAK,EAAC,IAAI,EAAC,EAAE;oBACnC,4BAA4B,CAAC,OAAO,EAAE,WAAW,EAAE,IAAI,EAAE,GAAG,EAAE,CAAC,SAAS,EAAE,eAAe,CAAC,aAAc,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;gBACzH,CAAC,CAAC,CAAC;gBACH,aAAa,CAAC,OAAO,EAAE,WAAW,EAAE,GAAG,EAAE,CAAC,SAAS,EAAE,eAAe,CAAC,aAAc,CAAC,OAAO,CAAC,IAAI,EAAE,IAAI,CAAC;gBAEvG,6DAA6D;gBAC7D,IAAI,OAAO,CAAC,KAAK,EAAE;oBACjB,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,MAAM,EAAE,IAAI,EAAE,EAAE;wBACnD,IAAI,IAAI,CAAC,IAAI,KAAK,KAAK,EAAE;4BACvB,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,KAAK,EAAE,SAAqB,EAAE,EAAE;gCACrD,MAAM,IAAI,GAAG,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,EAAE,KAAK,SAAS,CAAC,EAAE,CAAC,CAAC;gCACpE,IAAG,IAAI,EAAC;oCACN,MAAM,OAAO,GAAG,IAAY;oCAC5B,4BAA4B,CAAC,OAAO,EAAE,WAAW,EAAE,OAAO,EAAE,GAAG,EAAE,CAAC,SAAS,EAAE,eAAe,CAAC,aAAc,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;oCAC1H,MAAM,aAAa,CAAC,OAAO,EAAE,WAAW,EAAE,GAAG,EAAE,CAAC,SAAS,EAAE,eAAe,CAAC,aAAc,CAAC,OAAO,CAAC,IAAI,EAAE,IAAI,CAAC;iCAC9G;4BACH,CAAC,CAAC,CAAC;yBACJ;oBACH,CAAC,CAAC,CAAC;iBACJ;YACH,CAAC,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;QAEH,mEAAmE;QACnE,eAAe,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC,MAAM,EAAE,aAA4B,EAAE,EAAE;;YAC3E,4DAA4D;YAC1D,qBAAe,CAAC,aAAa,0CAAE,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,EAAE;gBACrD,IAAG;oBACD,OAAO,CAAC,GAAG,CAAC,8BAA8B,CAAC,CAAC;oBAC5C,8CAA8C;oBAC9C,gBAAgB,CAAC,QAAQ,EAAE,WAAW,EAAE,aAAa,EAAE,GAAG,EAAE,CAAC,SAAS,EAAE,aAAa,EAAE,eAAe,CAAC,aAAc,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;oBACpI,OAAO,CAAC,GAAG,CAAC,4BAA4B,CAAC,CAAC;iBAC3C;gBAAC,WAAM;oBACN,OAAO,CAAC,GAAG,CAAC,oCAAoC,CAAC;iBAClD;YACH,CAAC,CAAC,CAAC;YAEL,KAAK;QACP,CAAC,CAAC,CAAC;IACL,CAAC;CACF,CAAC;AAEF,+CAA+C;AAC/C,MAAM,WAAY,SAAQ,mDAAM;IAO9B,YAAY,eAAiC;QAC3C,KAAK,EAAE,CAAC;QACR,IAAI,CAAC,QAAQ,GAAG,IAAI,GAAG,EAAyB,CAAC;QACjD,IAAI,CAAC,UAAU,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;QAChD,IAAI,CAAC,gBAAgB,GAAG,eAAe,CAAC;QACxC,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC;QAC3B,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,SAAS,GAAG,OAAO,CAAC;QAC1C,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,SAAS,GAAG,MAAM,CAAC;QAEzC,IAAI,KAAK,GAAG,QAAQ,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;QACzC,KAAK,CAAC,SAAS,GAAG,iCAAiC,CAAC;QACpD,KAAK,CAAC,KAAK,CAAC,MAAM,GAAG,MAAM,CAAC;QAE5B,yBAAyB;QACzB,IAAI,MAAM,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;QAC3C,MAAM,CAAC,KAAK,CAAC,OAAO,GAAG,MAAM,CAAC;QAC9B,MAAM,CAAC,KAAK,CAAC,UAAU,GAAG,QAAQ,CAAC;QACnC,MAAM,CAAC,KAAK,CAAC,MAAM,GAAG,MAAM,CAAC;QAE7B,IAAI,aAAa,GAAG,QAAQ,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC;QACpD,aAAa,CAAC,IAAI,GAAG,UAAU,CAAC;QAChC,aAAa,CAAC,EAAE,GAAG,eAAe,CAAC;QACnC,aAAa,CAAC,OAAO,GAAG,IAAI,CAAC,cAAc,CAAC;QAE5C,IAAI,kBAAkB,GAAG,QAAQ,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC;QACzD,kBAAkB,CAAC,OAAO,GAAG,eAAe,CAAC;QAC7C,kBAAkB,CAAC,WAAW,GAAG,0BAA0B,CAAC;QAE5D,aAAa,CAAC,gBAAgB,CAAC,QAAQ,EAAE,GAAG,EAAE;YAC5C,IAAI,CAAC,cAAc,GAAG,aAAa,CAAC,OAAO,CAAC;QAC9C,CAAC,CAAC,CAAC;QAGH,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;QAE7B,MAAM,CAAC,WAAW,CAAC,aAAa,CAAC,CAAC;QAClC,MAAM,CAAC,WAAW,CAAC,kBAAkB,CAAC,CAAC;QACvC,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;QAE9B,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;IACzC,CAAC;IAED,+DAA+D;IAC/D,OAAO,CAAC,MAAc,EAAE,aAAqB,EAAE,QAAgB;QAC7D,MAAM,eAAe,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;QACtD,+DAA+D;QAC/D,eAAe,CAAC,EAAE,GAAG,OAAO,GAAG,MAAM,GAAG,GAAG,GAAG,QAAQ,CAAC;QAEvD,MAAM,QAAQ,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;QAC/C,QAAQ,CAAC,KAAK,CAAC,OAAO,GAAG,MAAM,CAAC;QAChC,QAAQ,CAAC,KAAK,CAAC,UAAU,GAAG,QAAQ,CAAC;QACrC,QAAQ,CAAC,KAAK,CAAC,QAAQ,GAAG,QAAQ,CAAC;QAEnC,QAAQ;QACR,MAAM,MAAM,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;QAChD,MAAM,CAAC,SAAS,CAAC,GAAG,CAAC,iBAAiB,CAAC,CAAC;QACxC,MAAM,CAAC,SAAS,CAAC,GAAG,CAAC,aAAa,CAAC,CAAC;QACpC,MAAM,CAAC,SAAS,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC;QACrC,MAAM,CAAC,SAAS,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC;QAClC,MAAM,CAAC,KAAK,CAAC,MAAM,GAAG,KAAK,CAAC;QAC5B,MAAM,CAAC,KAAK,CAAC,WAAW,GAAG,KAAK,CAAC;QACjC,MAAM,CAAC,KAAK,CAAC,UAAU,GAAG,KAAK,CAAC;QAChC,MAAM,CAAC,KAAK,CAAC,UAAU,GAAG,GAAG,CAAC;QAC9B,MAAM,CAAC,WAAW,GAAG,aAAa,CAAC;QAEnC,MAAM,CAAC,gBAAgB,CAAC,OAAO,EAAE,GAAG,EAAE;YACpC,IAAI,CAAC,YAAY,CAAC,MAAM,EAAE,QAAQ,EAAE,IAAI,CAAC,cAAc,CAAC,CAAC;QAC3D,CAAC,CAAC,CAAC;QAEH,uBAAuB;QACvB,MAAM,QAAQ,GAAG,QAAQ,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;QAChD,QAAQ,CAAC,SAAS,GAAG,SAAS,CAAC;QAC/B,QAAQ,CAAC,KAAK,CAAC,MAAM,GAAG,SAAS,CAAC;QAClC,QAAQ,CAAC,KAAK,CAAC,WAAW,GAAG,KAAK,CAAC;QAEnC,MAAM,OAAO,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;QAC9C,OAAO,CAAC,EAAE,GAAG,UAAU,GAAG,MAAM,CAAC;QACjC,OAAO,CAAC,KAAK,CAAC,OAAO,GAAG,MAAM,CAAC;QAC/B,OAAO,CAAC,KAAK,CAAC,MAAM,GAAG,MAAM,CAAC;QAE9B,UAAU;QACV,MAAM,UAAU,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;QACjD,UAAU,CAAC,KAAK,CAAC,OAAO,GAAG,MAAM;QAEjC,MAAM,YAAY,GAAG,QAAQ,CAAC,aAAa,CAAC,UAAU,CAAC,CAAC;QACxD,YAAY,CAAC,KAAK,CAAC,OAAO,GAAG,MAAM,CAAC;QACpC,YAAY,CAAC,KAAK,CAAC,MAAM,GAAG,iBAAiB,CAAC;QAC9C,YAAY,CAAC,KAAK,CAAC,MAAM,GAAG,KAAK,CAAC;QAClC,YAAY,CAAC,KAAK,CAAC,UAAU,GAAG,MAAM,CAAC;QACvC,YAAY,CAAC,KAAK,CAAC,MAAM,GAAG,OAAO,CAAC;QACpC,YAAY,CAAC,KAAK,CAAC,KAAK,GAAG,MAAM,CAAC;QAClC,YAAY,CAAC,KAAK,CAAC,UAAU,GAAG,GAAG,CAAC;QACpC,YAAY,CAAC,KAAK,CAAC,QAAQ,GAAG,MAAM,CAAC;QACrC,YAAY,CAAC,KAAK,GAAG,EAAE,CAAC;QACxB,YAAY,CAAC,KAAK,CAAC,QAAQ,GAAG,MAAM,CAAC;QACrC,YAAY,CAAC,KAAK,CAAC,UAAU,GAAG,OAAO,CAAC;QAExC,MAAM,aAAa,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;QACvD,aAAa,CAAC,SAAS,CAAC,GAAG,CAAC,iBAAiB,CAAC,CAAC;QAC/C,aAAa,CAAC,SAAS,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC;QAC5C,aAAa,CAAC,KAAK,CAAC,MAAM,GAAG,MAAM,CAAC;QACpC,aAAa,CAAC,KAAK,CAAC,MAAM,GAAG,KAAK,CAAC;QACnC,aAAa,CAAC,WAAW,GAAG,OAAO,CAAC;QACpC,aAAa,CAAC,gBAAgB,CAAC,OAAO,EAAE,GAAG,EAAE;YAC3C,IAAI,CAAC,YAAY,CAAC,MAAM,EAAE,YAAY,CAAC,KAAK,CAAC,CAAC;QAChD,CAAC,CAAC,CAAC;QAIH,cAAc;QACd,MAAM,QAAQ,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;QAC/C,QAAQ,CAAC,KAAK,CAAC,OAAO,GAAG,MAAM,CAAC;QAChC,QAAQ,CAAC,KAAK,CAAC,UAAU,GAAG,MAAM,CAAC;QACnC,QAAQ,CAAC,KAAK,CAAC,WAAW,GAAG,MAAM,CAAC;QACpC,QAAQ,CAAC,KAAK,CAAC,eAAe,GAAG,OAAO,CAAC;QACzC,QAAQ,CAAC,KAAK,CAAC,MAAM,GAAG,iBAAiB,CAAC;QAC1C,QAAQ,CAAC,KAAK,CAAC,OAAO,GAAG,KAAK,CAAC;QAC/B,MAAM,IAAI,GAAG,QAAQ,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC;QACzC,IAAI,aAAa,CAAC,QAAQ,CAAC,cAAc,CAAC,EAAC;YACzC,IAAI,CAAC,IAAI,GAAG,+DAA+D,CAAC;YAC5E,IAAI,CAAC,WAAW,GAAG,8BAA8B,CAAC;SACnD;aAAM,IAAG,aAAa,CAAC,QAAQ,CAAC,SAAS,CAAC,EAAC;YAC1C,IAAI,CAAC,IAAI,GAAG,2DAA2D,CAAC;YACxE,IAAI,CAAC,WAAW,GAAG,0BAA0B,CAAC;SAC/C;aAAM,IAAG,aAAa,CAAC,QAAQ,CAAC,KAAK,CAAC,EAAC;YACtC,IAAI,CAAC,IAAI,GAAG,6CAA6C,CAAC;YAC1D,IAAI,CAAC,WAAW,GAAG,0BAA0B,CAAC;SAC/C;aAAM,IAAG,aAAa,CAAC,QAAQ,CAAC,UAAU,CAAC,EAAC;YAC3C,IAAI,CAAC,IAAI,GAAG,mEAAmE,CAAC;YAChF,IAAI,CAAC,WAAW,GAAG,qCAAqC,CAAC;SAC1D;QACD,IAAI,CAAC,KAAK,CAAC,KAAK,GAAG,MAAM,CAAC;QAC1B,IAAI,CAAC,KAAK,CAAC,cAAc,GAAG,WAAW,CAAC;QAExC,IAAI,CAAC,MAAM,GAAG,QAAQ,CAAC;QACvB,QAAQ,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;QAE3B,qCAAqC;QACrC,QAAQ,CAAC,gBAAgB,CAAC,OAAO,EAAE,GAAG,EAAE;YACpC,QAAQ,CAAC,KAAK,CAAC,OAAO,GAAG,QAAQ,CAAC,KAAK,CAAC,OAAO,KAAK,MAAM,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,MAAM,CAAC;QAClF,CAAC,CAAC,CAAC;QAGH,IAAI,GAAG,GAAG,IAAI,CAAC;QACf,4EAA4E;QAC5E,IAAI,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,MAAM,CAAC,EAAC;YAC5B,IAAI,YAAY,GAAG,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,MAAM,CAAC;YAC5C,YAAa,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE;gBACxB,IAAI,CAAC,CAAC,WAAW,IAAI,aAAa,EAAE;oBAClC,GAAG,GAAG,KAAK,CAAC;iBACb;YACH,CAAC,CAAC;YAEF,YAAa,CAAC,IAAI,CAAC,eAAe,CAAC;YACnC,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,MAAM,EAAE,YAAa,CAAC,CAAC;SAC1C;aAAM;YACL,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,MAAM,EAAE,CAAC,eAAe,CAAC,CAAC,CAAC;SAC9C;QAED,IAAI,GAAG,EAAE;YACP,QAAQ,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;YAC7B,QAAQ,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC;YAC/B,eAAe,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC;YACtC,eAAe,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC;YAEtC,UAAU,CAAC,WAAW,CAAC,YAAY,CAAC,CAAC;YACrC,UAAU,CAAC,WAAW,CAAC,aAAa,CAAC,CAAC;YACtC,eAAe,CAAC,WAAW,CAAC,UAAU,CAAC,CAAC;YAExC,eAAe,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;YAErC,IAAI,CAAC,UAAU,CAAC,WAAW,CAAC,eAAe,CAAC,CAAC;SAC9C;QAED,+BAA+B;IACjC,CAAC;IAED,UAAU,CAAC,MAAc,EAAE,cAAsB;QAC/C,MAAM,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;QAC3C,IAAI,QAAQ,IAAI,IAAI,EAAE;YACpB,oFAAoF;YACpF,iBAAiB;YACjB,MAAM,UAAU,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAC,gBAAgB,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;YAC1D,mBAAmB;YACnB,MAAM,YAAY,GAAG,UAAU,CAAC,gBAAgB,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC;YAChE,YAAY,CAAC,KAAK,GAAG,cAAc,CAAC;YACpC,UAAU,CAAC,KAAK,CAAC,OAAO,GAAG,MAAM,CAAC;SACnC;IACH,CAAC;IAED,+CAA+C;IAC/C,UAAU,CAAC,MAAc;QACvB,gDAAgD;QAChD,MAAM,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;QAC3C,IAAI,QAAQ,IAAI,IAAI,EAAE;YACpB,QAAQ,CAAC,OAAO,CAAC,CAAC,GAAG,EAAE,EAAE;gBACvB,KAAK,IAAI,IAAI,IAAI,IAAI,CAAC,UAAU,CAAC,QAAQ,EAAE;oBACzC,IAAI,GAAG,CAAC,EAAE,IAAI,IAAI,CAAC,EAAE,EAAE;wBACrB,IAAI,CAAC,UAAU,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;qBAClC;iBACF;YACH,CAAC,CAAC,CAAC;SACJ;QACD,IAAG,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,MAAM,CAAC,EAAC;YAC3B,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;SAC9B;IACH,CAAC;IAED,YAAY,CAAC,MAAc,EAAE,cAAsB;;QAEjD,MAAM,aAAa,GAAG,IAAI,CAAC,gBAAgB,CAAC,aAAa,CAAC;QAC1D,MAAM,QAAQ,GAAG,aAAc,CAAC,OAAO,CAAC;QAExC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,QAAQ,CAAC,OAAO,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YAChD,MAAM,IAAI,GAAG,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;YACjC,IAAI,IAAI,CAAC,KAAK,CAAC,EAAE,KAAK,MAAM,EAAE;gBAC5B,IAAI,IAAI,CAAC,KAAK,CAAC,IAAI,IAAI,UAAU,EAAE;oBACjC,MAAM,WAAW,GAAG,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,SAAS,EAAE,CAAC;oBACvD,MAAM,gBAAgB,GAAG,0BAA0B,CAAC;oBACpD,MAAM,YAAY,GAAG,yDAAyD,CAAC;oBAE/E,MAAM,gBAAgB,GAAG,WAAW,CAAC,OAAO,CAAC,gBAAgB,EAAE,CAAC,CAAC,EAAE,OAAO,EAAE,GAAG,EAAE,EAAE;wBACjF,mBAAmB;wBACnB,OAAO,CAAC,GAAG,CAAC,+BAA+B,GAAG,EAAE,CAAC,CAAC;wBAClD,4EAA4E;wBAC5E,cAAc,GAAG,cAAc,CAAC,OAAO,CAAC,UAAU,EAAE,GAAG,CAAC,CAAC;wBACzD,OAAO,KAAK,cAAc,KAAK,GAAG,GAAG,CAAC;oBACxC,CAAC,CAAC,CAAC;oBAEH,4CAA4C;oBAC5C,IAAI,gBAAgB,KAAK,WAAW,EAAE;wBACpC,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,SAAS,CAAC,gBAAgB,CAAC,CAAC;qBACpD;oBAED,MAAM,kBAAkB,GAAG,WAAW,CAAC,OAAO,CAAC,YAAY,EAAE,CAAC,KAAK,EAAE,SAAS,EAAE,QAAQ,EAAE,EAAE;wBAC1F,oDAAoD;wBACpD,IAAI,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE;4BACxB,mCAAmC;4BACnC,OAAO,KAAK,CAAC,OAAO,CAAC,sBAAsB,EAAE,QAAQ,cAAc,GAAG,CAAC,CAAC;yBAC3E;6BAAM;4BACH,wDAAwD;4BACxD,OAAO,QAAQ,SAAS,SAAS,cAAc,KAAK,QAAQ,GAAG,CAAC;yBACnE;oBACH,CAAC,CAAC,CAAC;oBAEH,4CAA4C;oBAC5C,IAAI,kBAAkB,KAAK,WAAW,EAAE;wBACtC,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,SAAS,CAAC,kBAAkB,CAAC,CAAC;qBACtD;iBACF;gBACD,oEAAoE;qBAC/D;oBACH,MAAM,YAAY,GAAG;wBACnB,SAAS,EAAE,UAAU;wBACrB,QAAQ,EAAE,EAAE;wBACZ,MAAM,EAAE,wBAAwB;wBAChC,OAAO,EAAE,IAAI;qBACd,CAAC;oBACF,kBAAkB;oBAClB,cAAQ,CAAC,KAAK,0CAAE,WAAW,CAAC,UAAU,CAAC,CAAC,EAAE,YAAY,CAAC,CAAC;oBACxD,qDAAqD;iBACtD;aACF;SACF;IACH,CAAC;IAED,KAAK,CAAC,eAAe,CAAC,SAAiB,EAAE,MAAc;QACrD,MAAM,MAAM,GAAG,QAAQ,CAAC,cAAc,CAAC,UAAU,GAAG,MAAM,CAAC,CAAC;QAC5D,IAAI,MAAM,EAAE;YACV,MAAM,CAAC,KAAK,CAAC,OAAO,GAAG,OAAO,CAAC;YAC/B,MAAM,OAAO,GAAG,kEAAa,CAAC,MAAM,CAAC,CAAC;YACtC,IAAI;gBACF,MAAM,OAAO,GAAG,MAAM,gBAAgB,CAAC,SAAS,IAAI,GAAG,CAAC,CAAC;gBACzD,IAAI,CAAC,UAAU,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC;aAClC;YAAC,OAAO,KAAK,EAAE;gBACZ,OAAO,CAAC,KAAK,CAAC,4BAA4B,EAAE,KAAK,CAAC,CAAC;aACtD;oBAAS;gBACN,gEAAW,CAAC,OAAO,CAAC,CAAC;gBACrB,MAAM,CAAC,KAAK,CAAC,OAAO,GAAG,MAAM,CAAC;aACjC;SACF;IACH,CAAC;IAED,6BAA6B;IAC7B,YAAY,CAAC,MAAc,EAAE,QAAgB,EAAE,cAAuB;;QACpE,MAAM,aAAa,GAAG,IAAI,CAAC,gBAAgB,CAAC,aAAa,CAAC;QAC1D,MAAM,QAAQ,GAAG,aAAc,CAAC,OAAO,CAAC;QAExC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,QAAQ,CAAC,OAAO,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YAChD,MAAM,IAAI,GAAG,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;YACjC,IAAI,IAAI,CAAC,KAAK,CAAC,EAAE,KAAK,MAAM,EAAE;gBAC5B,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,EAAE,QAAQ,EAAE,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,CAAC,CAAC;gBAEhE,0DAA0D;gBAC1D,MAAM,aAAa,GAAG,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC;gBACjD,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,UAAU,GAAG,4BAA4B,CAAC;gBAC1D,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,eAAe,GAAG,SAAS,CAAC;gBAC5C,UAAU,CAAC,GAAG,EAAE;oBACd,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,eAAe,GAAG,EAAE,CAAC;oBACrC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,UAAU,GAAG,aAAa,CAAC;gBAC7C,CAAC,EAAE,GAAG,CAAC,CAAC;gBAER,uBAAuB;gBACvB,IAAI,QAAQ,IAAI,KAAK,EAAE;oBACrB,IAAI,CAAC,cAAc;wBAAE,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;yBACnD;wBACH,MAAM,QAAQ,GAAG,UAAI,CAAC,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,0CAAE,GAAG,CAAC;wBACrD,IAAI,QAAQ,EAAE;4BACZ,IAAI,CAAC,eAAe,CAAC,QAAQ,EAAE,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC;yBAC/C;qBACF;iBACF;aACF;SACF;IACH,CAAC;IAED,4DAA4D;IAC5D,+DAA+D;IAC/D,oBAAoB;QAClB,OAAO,CAAC,GAAG,CAAC,4BAA4B,CAAC,CAAC;QAC1C,IAAI,OAAO,GAAG,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC,CAAC;QAC/C,MAAM,aAAa,GAAG,IAAI,CAAC,gBAAgB,CAAC,aAAa,CAAC;QAC1D,MAAM,QAAQ,GAAG,aAAc,CAAC,OAAO,CAAC;QAExC,OAAO,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE;YAClB,IAAI,UAAU,GAAG,KAAK,CAAC;YACvB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,QAAQ,CAAC,OAAO,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;gBAChD,MAAM,IAAI,GAAG,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;gBACjC,IAAI,IAAI,CAAC,KAAK,CAAC,EAAE,KAAK,CAAC,EAAE;oBACvB,UAAU,GAAG,IAAI,CAAC;oBAClB,MAAK;iBACN;aACF;YACD,IAAG,CAAC,UAAU,EAAC;gBACb,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;aACpB;QACH,CAAC,CAAC,CAAC;IACL,CAAC;CACF;AAED,iEAAe,MAAM,EAAC","sources":["webpack://jupyterlab-a11y-checker/./src/components/Spinner.ts","webpack://jupyterlab-a11y-checker/./src/index.ts"],"sourcesContent":["import { Spinner } from 'spin.js';\n\n// Spinner configuration options\nconst spinnerOptions = {\n  lines: 12, // Number of lines in the spinner\n  length: 20, // Length of each line\n  width: 10, // Thickness of each line\n  radius: 25, // Radius of the inner circle\n  scale: 0.2, // Scales the whole spinner\n  corners: 1, // Corner roundness (0..1)\n  color: '#154F92', // Spinner color\n  fadeColor: 'transparent', // Fade color\n  speed: 1, // Rounds per second\n  rotate: 0, // Rotation offset\n  animation: 'spinner-line-fade-quick', // CSS animation\n  position: 'relative', // Element positioning\n};\n\nexport function createSpinner(target: HTMLElement): Spinner {\n  const spinner = new Spinner(spinnerOptions);\n  spinner.spin(target);\n  return spinner;\n}\n\nexport function stopSpinner(spinner: Spinner | null): void {\n  if (spinner) spinner.stop();\n}","import {\n  ILabShell,\n  JupyterFrontEnd,\n  JupyterFrontEndPlugin\n} from '@jupyterlab/application';\n\nimport { INotebookTracker, Notebook, NotebookPanel } from '@jupyterlab/notebook';\nimport { ToolbarButton } from '@jupyterlab/apputils';\nimport { IDisposable } from '@lumino/disposable';\nimport { Widget } from '@lumino/widgets';\nimport { LabIcon } from '@jupyterlab/ui-components';\nimport { Cell, CodeCell, ICellModel, MarkdownCell } from '@jupyterlab/cells';\n\n// import ColorThief from 'colorthief';\nimport Tesseract from 'tesseract.js';\nimport axios from 'axios';\nimport { createSpinner, stopSpinner } from './components/Spinner';\n\n\nfunction calculateContrast(foregroundHex: string, backgroundHex: string): number {\n\n  //convert hex string to tuple of rgb\n  function hexToRgb(hex: string): { r: number; g: number; b: number } {\n    const r = parseInt(hex.slice(1, 3), 16);\n    const g = parseInt(hex.slice(3, 5), 16);\n    const b = parseInt(hex.slice(5, 7), 16);\n    return { r, g, b };\n  }\n  \n  //calulate luminance using wcag docs formula \n  function calculateLuminance(rgb: { r: number; g: number; b: number }): number {\n    const a = [rgb.r, rgb.g, rgb.b].map(function (v) {\n      v /= 255;\n      return v <= 0.04045 ? v / 12.92 : Math.pow((v + 0.055) / 1.055, 2.4);\n    });\n    return a[0] * 0.2126 + a[1] * 0.7152 + a[2] * 0.0722;\n  }\n  \n  function getContrastRatio(color1: string, color2: string): number {\n    const rgb1 = hexToRgb(color1);\n    const rgb2 = hexToRgb(color2);\n    const L1 = calculateLuminance(rgb1);\n    const L2 = calculateLuminance(rgb2);\n    const lighter = Math.max(L1, L2);\n    const darker = Math.min(L1, L2);\n    return (lighter + 0.05) / (darker + 0.05);\n  }\n\n  try{\n    const contrast = getContrastRatio(foregroundHex, backgroundHex);\n    return contrast;\n  } catch {\n    return 21;\n  }\n}\n\nasync function determineTextColor(imageData: ImageData, imagePath: string, scale: number): Promise<number> {\n  const result = await Tesseract.recognize(imagePath, 'eng', {});\n  const words = result.data.words;\n  if (words.length === 0) {\n      throw new Error('No text found in the image');\n  }\n  let minContrast = 21;\n  words.forEach(word => {\n    //Filter out nonsense detections\n    if(word.confidence >= 85 && word.text != \"|\" && word.text != \"-\" && word.text != \"_\" && word.text != \"/\" && word.text != \"=\"){\n      const bbox = word.bbox;\n    \n      const colorCount: { [key: string]: number } = {};\n      const data = imageData.data;\n      const width = imageData.width;\n    \n      //for each bounding box, find the most common clors and store them in a dictionary\n      for (let y = bbox.y0; y <= bbox.y1; y++) {\n          for (let x = bbox.x0; x <= bbox.x1; x++) {\n              const index = (y * width + x) * 4;\n              const { r, g, b } = { r: data[index], g: data[index + 1], b: data[index + 2] }\n              const colorKey = \"#\" + ((1 << 24) + (Math.floor(r/scale)*scale << 16) + (Math.floor(g/scale)*scale << 8) + Math.floor(b/scale)*scale).toString(16).slice(1).toUpperCase()\n              colorCount[colorKey] = (colorCount[colorKey] || 0) + 1;\n          }\n      }\n\n      var bgcol = Object.entries(colorCount).sort((a, b) => b[1] - a[1])[0][0]; //most common\n      var fgcol = Object.entries(colorCount).sort((a, b) => b[1] - a[1])[1][0]; //second most common (text color)\n\n      // console.log(colorCount)\n      \n      let contrast = calculateContrast(fgcol, bgcol);\n      // console.log(word.text + \" \" + word.confidence + \" \" + fgcol + \" vs. \" + bgcol + \" with contrast \" + contrast);\n\n      //find the word with minimum contrast to flag as an issue\n      if(contrast < minContrast){\n        minContrast = contrast;\n      }\n    }\n  });\n\n  return minContrast;\n}\n\nasync function getTextContrast(imageSrc: string){\n  return new Promise((resolve, reject) => {\n    const img = new Image();\n    img.crossOrigin = 'Anonymous'; // Needed if the image is served from a different domain\n    \n    //distunguish between local or hosted url\n    try {\n      new URL(imageSrc);\n      img.src = imageSrc;\n    } catch (_) {\n      const baseUrl = document.location.origin;\n      var finalPath = `${baseUrl}/files/${imageSrc}`\n      img.src = finalPath;\n    }\n\n    try{\n      img.onload = async () => {\n        const canvas = document.createElement('canvas');\n        canvas.width = img.width;\n        canvas.height = img.height;\n        const ctx = canvas.getContext('2d');\n        if (!ctx) {\n          resolve(\"21 contrast 21.00:1\")\n          return;\n        }\n        ctx.drawImage(img, 0, 0);\n        var imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n        let textContrast;\n        try {\n          textContrast = await determineTextColor(imageData, img.src, 30);\n        } catch (error) {\n          console.error(error);\n          textContrast = 21; // Default to black if no text is found\n        }\n  \n        resolve(`${textContrast} contrast ${textContrast.toFixed(2)}:1`);\n      };\n    } catch {\n      resolve(\"21 contrast 21.00:1\");\n    }\n    \n\n    // img.onerror = () => reject('Failed to load image');\n  });\n}\n      \nfunction getImageTransparency(imgString: string, notebookPath: string): Promise<String> {\n  return new Promise((resolve, reject) => {\n    const img = new Image();\n    img.crossOrigin = 'Anonymous'; // Needed for CORS-compliant images\n    //distunguish between local or hosted url\n    try {\n      new URL(imgString);\n      img.src = imgString;\n    } catch (_) {\n      const baseUrl = document.location.origin;\n      var finalPath = `${baseUrl}/files/${imgString}`\n      img.src = finalPath;\n    }\n    try{\n      img.onload = () => {\n        const canvas = document.createElement('canvas');\n        canvas.width = img.width;\n        canvas.height = img.height;\n  \n        const context = canvas.getContext('2d');\n        if (!context) {\n          // console.log('Failed to get canvas context');\n          resolve(10 + \" transp\");\n          return;\n        }\n  \n        context.drawImage(img, 0, 0);\n        const imageData = context.getImageData(0, 0, canvas.width, canvas.height);\n        const data = imageData.data;\n  \n        let transparentPixelCount = 0;\n        const totalPixels = data.length / 4;\n  \n        for (let i = 3; i < data.length; i += 4) {\n          //if any pixel is even slightly transparent, flag as transparent\n          if (data[i] < 255) {\n            transparentPixelCount++;\n          }\n        }\n  \n        //returns ratio of ht eimage that is opaque\n        const transparencyPercentage = (transparentPixelCount / totalPixels) * 100;\n        resolve((10 - transparencyPercentage/10) + \" transp\");\n      };\n    } catch {\n      console.log('Failed to get canvas context');\n      resolve(10 + \" transp\");\n    }\n  });\n}\n\nasync function checkHtmlNoAccessIssues(htmlString: string, myPath: string, cellColor: string): Promise<string[]> {\n  //Finds all possible issues within a cell while parsing it as HTML\n  return new Promise(async (resolve, reject) => {\n    const parser = new DOMParser();\n    const doc = parser.parseFromString(htmlString, \"text/html\");\n    const images = doc.querySelectorAll(\"img\");\n  \n    let accessibilityTests: string[] = [];\n    for (let i = 0; i < images.length; i++) {\n      const img = images[i];\n      if (!img.hasAttribute(\"alt\") || img.getAttribute(\"alt\") === \"\") {\n        accessibilityTests.push(\"Alt\");\n      }\n\n      // console.log(img); // prints out urls from html with no alt text\n    }\n\n    const transparencyPromises = Array.from(images).map((img: HTMLImageElement) => getImageTransparency(img.src, myPath));\n    const transparency = await Promise.all(transparencyPromises);\n\n    const colorContrastPromises = Array.from(images).map((img: HTMLImageElement) => getTextContrast(img.src));\n    const colorContrast =  await Promise.all(colorContrastPromises);\n  \n    accessibilityTests = [...accessibilityTests, ...transparency.map(String), ...colorContrast.map(String)];\n    \n    resolve(accessibilityTests);\n  });\n}\n\nasync function checkMDNoAccessIssues(mdString: string, myPath: string, cellColor: string): Promise<string[]> {\n  //Finds all possible issues within a cell while parsing it as markdown\n  return new Promise(async (resolve, reject) => {\n    const imageNoAltRegex = /!\\[\\](\\([^)]+\\))/g;\n    const allImagesRegex = /!\\[.*?\\]\\((.*?)\\)/g;\n    let accessibilityTests: string[] = [];\n  \n    let match: RegExpExecArray | null;\n    const imageUrls: string[] = [];\n\n    while ((match = allImagesRegex.exec(mdString)) !== null) {\n        const imageUrl = match[1];\n        if (imageUrl) {\n            imageUrls.push(imageUrl);\n        }\n    }\n\n    if (imageNoAltRegex.test(mdString)){\n      accessibilityTests.push(\"Alt\");\n    }\n    \n    \n    const transparencyPromises = Array.from(imageUrls).map((i: string) => getImageTransparency(i, myPath));\n    const transparency = await Promise.all(transparencyPromises);\n\n    const colorContrastPromises = Array.from(imageUrls).map((i: string) => getTextContrast(i));\n    const colorContrast = await Promise.all(colorContrastPromises);\n  \n    accessibilityTests = [...accessibilityTests, ...transparency.map(String), ...colorContrast.map(String)];\n\n    resolve(accessibilityTests);\n  });\n}\n\nasync function checkTextCellForImageWithAccessIssues(cell: Cell, myPath: string): Promise<string[]> {\n  //finds all issues within a text cell by parsing it as both markdown and html\n  try{\n    if(cell.model.type == 'markdown'){\n      cell = cell as MarkdownCell;\n      const cellText = cell.model.toJSON().source.toString();   \n      const markdownNoAlt = await checkMDNoAccessIssues(cellText, myPath, document.body.style.getPropertyValue(\"--fill-color\"));\n      const htmlNoAlt = await checkHtmlNoAccessIssues(cellText, myPath, document.body.style.getPropertyValue(\"--fill-color\"));\n      var issues = htmlNoAlt.concat(markdownNoAlt)\n      return issues;\n    } else {\n      return [];\n    }\n  } catch {\n    return [];\n  }\n  \n}\n\nasync function checkCodeCellForImageWithAccessIssues(cell: Cell, myPath: string): Promise<string[]> {\n  //finds all issues in the output of a code cell.\n  //output of a code cell is return in rendered html format,\n  //so only need to check with html accessibility.\n  try{\n    if(cell.model.type == 'code'){\n      const codeCell = cell as CodeCell;\n      const outputText = codeCell.outputArea.node.outerHTML;\n  \n      const generatedOutputImageIssues = await checkHtmlNoAccessIssues(outputText, myPath, document.body.style.getPropertyValue(\"--fill-color\"));\n      return generatedOutputImageIssues;\n    } else {\n      return [];\n    }\n  } catch {\n    return [];\n  }\n  \n}\n\nasync function checkAllCells(notebookContent: Notebook, altCellList: AltCellList, isEnabled: () => boolean, myPath: string, firstTime: boolean) {\n  const headingsMap: Array<{headingLevel: number, myCell: Cell, heading: string }> = [];\n\n  notebookContent.widgets.forEach(async cell => {\n    if (isEnabled()){\n      if(firstTime){\n        //Image transparency, contrast, and alt checking\n        //console.log(cell.model.sharedModel.getSource());\n        applyVisualIndicator(altCellList, cell, []);\n        const mdCellIssues = await checkTextCellForImageWithAccessIssues(cell, myPath);\n        const codeCellHasTransparency = await checkCodeCellForImageWithAccessIssues(cell, myPath);\n        var issues = mdCellIssues.concat(codeCellHasTransparency);\n        applyVisualIndicator(altCellList, cell, issues);\n      }\n      \n      //header ordering checking\n      if (cell.model.type === 'markdown') {\n        const mCell = cell as MarkdownCell;\n\n        const cellText = mCell.model.toJSON().source.toString();\n        const markdownHeadingRegex = /^(#+) \\s*(.*)$/gm;\n        const htmlHeadingRegex = /<h(\\d+)>(.*?)<\\/h\\1>/gi;\n\n        let match;\n        while ((match = markdownHeadingRegex.exec(cellText)) !== null) {\n          const level = match[1].length;  // The level is determined by the number of '#'\n          headingsMap.push({headingLevel: level, heading: `${match[2].trim()}`, myCell: mCell});\n        }\n\n        while ((match = htmlHeadingRegex.exec(cellText)) !== null) {\n          const level = parseInt(match[1]);  // The level is directly captured by the regex\n          headingsMap.push({headingLevel: level, heading: `${match[2].trim()}`, myCell: mCell });\n        }\n      }\n      \n      if (headingsMap.length > 0){\n        let previousLevel = headingsMap[0].headingLevel;\n        let highestLevel = previousLevel;\n        const errors: Array<{myCell: Cell, current: string, expected: string}> = [];\n  \n        headingsMap.forEach((heading, index) => {\n          if (heading.headingLevel > previousLevel + 1) {\n            // If the current heading level skips more than one level\n            errors.push({\n              myCell: heading.myCell,\n              current: `h${heading.headingLevel}`,\n              expected: `h${previousLevel + 1}`\n            });\n          } else if (heading.headingLevel < highestLevel){\n            //if the header is higher than the first ever header\n            errors.push({\n              myCell: heading.myCell,\n              current: `h${heading.headingLevel}`,\n              expected: `h${highestLevel}`\n            });\n          }\n  \n          previousLevel = heading.headingLevel;\n        });\n  \n        errors.forEach(e => {\n          //remove any issues in the heading cell which has an error before adding the heading errors\n          applyVisualIndicator(altCellList, e.myCell, [])\n          applyVisualIndicator(altCellList, e.myCell, [\"heading \" + e.current + \" \" + e.expected]);\n        });\n      }\n    } else {\n      applyVisualIndicator(altCellList, cell, []);\n    }\n  });\n  altCellList.showOnlyVisibleCells();\n}\n\nasync function attachContentChangedListener(notebookContent: Notebook, altCellList: AltCellList, cell: Cell, isEnabled: () => boolean, myPath: string) {\n  //for each existing cell, attach a content changed listener\n  cell.model.contentChanged.connect(async (sender, args) => {\n    //this checks only the headers\n    await checkAllCells(notebookContent, altCellList, isEnabled, myPath, false);\n\n    //checks for text contrast, alt tags, and transparency\n    applyVisualIndicator(altCellList, cell, []);\n    const mdCellIssues = await checkTextCellForImageWithAccessIssues(cell, myPath);\n    const codeCellHasTransparency = await checkCodeCellForImageWithAccessIssues(cell, myPath);\n    var issues = mdCellIssues.concat(codeCellHasTransparency);\n    applyVisualIndicator(altCellList, cell, issues);\n  });\n  \n}\n\nfunction applyVisualIndicator(altCellList: AltCellList, cell: Cell, listIssues: string[]) {\n  var indicatorId: string;\n  try {\n    indicatorId = 'accessibility-indicator-' + cell.model.id;\n  } catch {\n    return;\n  }\n  \n  altCellList.removeCell(cell.model.id);\n\n\n  //remove all indicators (red circles) on the given cell before adding\n  //a new one to remove possible duplicates\n  while(document.getElementById(indicatorId)){\n    document.getElementById(indicatorId)?.remove();\n  }\n\n  let applyIndic = false;\n\n  for (let i = 0; i < listIssues.length; i++) {\n    //cases for all 4 types of errors\n    if (listIssues[i].slice(0,7) == \"heading\") { //heading h1 h1\n      altCellList.addCell(cell.model.id, \"Heading format: expecting \" + listIssues[i].slice(11, 13) + \", got \" + listIssues[i].slice(8, 10), \"heading\");\n      applyIndic = true;\n    } else if(listIssues[i].split(\" \")[1] == \"contrast\"){\n      var score = Number(listIssues[i].split(\" \")[0]);\n      if (score < 4.5) {\n        altCellList.addCell(cell.model.id, \"Cell Error: Text Contrast \" + listIssues[i].split(\" \")[2], \"contrast\");\n        applyIndic = true;\n      }\n    } else if (listIssues[i] == \"Alt\") {\n      altCellList.addCell(cell.model.id, \"Cell Error: Missing Alt Tag\", \"alt\");\n      applyIndic = true;\n    } else {\n      var score = Number(listIssues[i].split(\" \")[0]);\n      if (score < 9) {\n        altCellList.addCell(cell.model.id, \"Image Err: High Image Transparency (\" + ((10-score)*10).toFixed(2) + \"%)\", \"transparency\");\n        applyIndic = true;\n      }\n    }\n  }\n  \n  \n  if (applyIndic) {\n    //styling for the red indicator\n    if (!document.getElementById(indicatorId)) {\n      var indicator = document.createElement('div');\n      indicator.id = indicatorId;\n      indicator.style.position = 'absolute';\n      indicator.style.top = '30px';\n      indicator.style.left = '45px';\n      indicator.style.width = '15px';\n      indicator.style.height = '15px';\n      indicator.style.borderRadius = '50%';\n      indicator.style.backgroundColor = '#ff8080';\n      cell.node.appendChild(indicator);\n    }\n  } else {\n    //if there are no errors, then remove the indicator\n    let indicator = document.getElementById(indicatorId);\n    indicator?.remove();\n    altCellList.removeCell(cell.model.id);\n  }\n  // altCellList.showOnlyVisibleCells();\n}\n\nasync function addToolbarButton(labShell: ILabShell, altCellList: AltCellList, notebookPanel: NotebookPanel, isEnabled: () => boolean, toggleEnabled: () => void, myPath: string): Promise<IDisposable> {\n  const button = new ToolbarButton({\n    label: '🌐 a11y Checker',\n    onClick: () => {\n      toggleEnabled();\n      if(isEnabled()){\n        labShell.activateById(\"AltCellList\");\n      } else {\n        labShell.collapseRight();\n      }\n      //on toggle, check all the cells\n      checkAllCells(notebookPanel.content, altCellList, isEnabled, myPath, true);\n    },\n\n    tooltip: 'Toggle Alt-text Check'\n  });\n\n  button.id = \"alt-text-check-toggle\";\n  notebookPanel.toolbar.insertItem(0, 'altTextCheck', button);\n  \n  let elem = document.getElementById('alt-text-check-toggle');\n  elem!.style.backgroundColor = '#0000';\n\n  return button;\n}\n\nasync function fetchImageAsBase64(imageUrl: string): Promise<string> {\n  const response = await axios.get(imageUrl, { responseType: 'blob' });\n  const imageBlob = response.data;\n  \n  // Create a FileReader to read the image as base64\n  const base64String = await new Promise<string>((resolve, reject) => {\n      const reader = new FileReader();\n      reader.onloadend = () => {\n          const result = reader.result as string;\n          resolve(result.split(',')[1]); // Strip off the data URL prefix (e.g., \"data:image/jpeg;base64,\")\n      };\n      reader.onerror = reject;\n      reader.readAsDataURL(imageBlob);\n  });\n\n  return base64String;\n}\n\nasync function sendImageToModel(imageData: string): Promise<string> {\n  try {\n      let encodedImage = imageData.startsWith(\"data:image\") ? imageData.split(\",\")[1] : await fetchImageAsBase64(imageData);\n      const payload = {\n          model: \"llava\",\n          // prompt: \"What is in this picture?\",\n          prompt: \"What can the user understand from looking at this image, describe it up to 240 characters.\",\n          stream: false,\n          images: [encodedImage]\n      };\n      console.log(\"Alt-text generating....\");\n      // For Hub\n      const response = await axios.post(\"https://a11y-staging.datahub.berkeley.edu/user/chanbin.park/ollama/api/generate\", payload, {\n          headers: { 'Content-Type': 'application/json' }\n      });\n\n      // For Local Testing\n      // const response = await axios.post(\"http://localhost:11434/api/generate\", payload, {\n      //     headers: { 'Content-Type': 'application/json' }\n      // });\n\n      console.log(\"Response: \", response);\n      let result = response.data.response.trim() + \" (This is an alt-text generated by a language model)\"\n      return result;\n  } catch (error) {\n      console.error('Error fetching or sending image:', error);\n      return \"Error generating alt-text for image\";\n  }\n};\n\nconst plugin: JupyterFrontEndPlugin<void> = {\n  id: 'jupyterlab_accessibility:plugin',\n  autoStart: true,\n  requires: [INotebookTracker, ILabShell],\n  activate: (app: JupyterFrontEnd, notebookTracker: INotebookTracker, labShell: ILabShell) => {\n    console.log('JupyterLab extension jupyterlab_accessibility is activated!');\n\n    let isEnabled = true;\n    // Function to toggle the isEnabled state\n    const toggleEnabled = () => {\n      isEnabled = !isEnabled;\n      console.log(`Accessibility checks ${isEnabled ? 'enabled' : 'disabled'}.`);\n    };\n\n    //icon for the sidebar\n    const accessibilityIcon = new LabIcon({\n      name: 'accessibility',\n      svgstr: '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\"><path fill=\"#154F92\" d=\"M256 48c114.953 0 208 93.029 208 208 0 114.953-93.029 208-208 208-114.953 0-208-93.029-208-208 0-114.953 93.029-208 208-208m0-40C119.033 8 8 119.033 8 256s111.033 248 248 248 248-111.033 248-248S392.967 8 256 8zm0 56C149.961 64 64 149.961 64 256s85.961 192 192 192 192-85.961 192-192S362.039 64 256 64zm0 44c19.882 0 36 16.118 36 36s-16.118 36-36 36-36-16.118-36-36 16.118-36 36-36zm117.741 98.023c-28.712 6.779-55.511 12.748-82.14 15.807.851 101.023 12.306 123.052 25.037 155.621 3.617 9.26-.957 19.698-10.217 23.315-9.261 3.617-19.699-.957-23.316-10.217-8.705-22.308-17.086-40.636-22.261-78.549h-9.686c-5.167 37.851-13.534 56.208-22.262 78.549-3.615 9.255-14.05 13.836-23.315 10.217-9.26-3.617-13.834-14.056-10.217-23.315 12.713-32.541 24.185-54.541 25.037-155.621-26.629-3.058-53.428-9.027-82.141-15.807-8.6-2.031-13.926-10.648-11.895-19.249s10.647-13.926 19.249-11.895c96.686 22.829 124.283 22.783 220.775 0 8.599-2.03 17.218 3.294 19.249 11.895 2.029 8.601-3.297 17.219-11.897 19.249z\"/></svg>'\n    });\n\n    const altCellList: AltCellList = new AltCellList(notebookTracker);\n    altCellList.id = 'AltCellList';\n    altCellList.title.icon = accessibilityIcon;\n    labShell.add(altCellList, 'right');\n    labShell.activateById('AltCellList');\n\n    notebookTracker.currentChanged.connect((sender, notebookPanel) => {\n      if (!notebookPanel) return;\n      \n      notebookPanel.context.ready.then(() => {\n        const { content } = notebookPanel;\n\n        //for each existing cell, attach a content changed listener\n        content.widgets.forEach(async cell => {\n          attachContentChangedListener(content, altCellList, cell, () => isEnabled, notebookTracker.currentWidget!.context.path);\n        });\n        checkAllCells(content, altCellList, () => isEnabled, notebookTracker.currentWidget!.context.path, true)\n\n        //every time a cell is added, attach a content listener to it\n        if (content.model) {\n          content.model.cells.changed.connect((sender, args) => {\n            if (args.type === 'add') {\n              args.newValues.forEach(async (cellModel: ICellModel) => {\n                const cell = content.widgets.find(c => c.model.id === cellModel.id);\n                if(cell){\n                  const newCell = cell as Cell\n                  attachContentChangedListener(content, altCellList, newCell, () => isEnabled, notebookTracker.currentWidget!.context.path);\n                  await checkAllCells(content, altCellList, () => isEnabled, notebookTracker.currentWidget!.context.path, true)\n                }          \n              });\n            }\n          });\n        }\n      });\n    });\n\n    // When a new notebook is created or opened, add the toolbar button\n    notebookTracker.widgetAdded.connect((sender, notebookPanel: NotebookPanel) => {\n      // while(!document.getElementById(\"alt-text-check-toggle\")){\n        notebookTracker.currentWidget?.context.ready.then(() => {\n          try{\n            console.log(\"trying to add toolbar button\");\n            // console.log(notebookTracker.currentWidget!)\n            addToolbarButton(labShell, altCellList, notebookPanel, () => isEnabled, toggleEnabled, notebookTracker.currentWidget!.context.path);\n            console.log(\"able to add toolbar button\");\n          } catch {\n            console.log(\"trying again to add toolbar button\")\n          }\n        });\n        \n      // } \n    });\n  }\n};\n\n//html styling/logic for rendering the side bar\nclass AltCellList extends Widget {\n  \n  private _listCells: HTMLElement;\n  private _cellMap: Map<string, HTMLElement[]>;\n  private _notebookTracker: INotebookTracker;\n  private _enableAltText: boolean;\n\n  constructor(notebookTracker: INotebookTracker) {\n    super();\n    this._cellMap = new Map<string, HTMLElement[]>();\n    this._listCells = document.createElement('div');\n    this._notebookTracker = notebookTracker;\n    this._enableAltText = true;\n    this._listCells.style.maxHeight = \"100vh\";\n    this._listCells.style.overflowY = \"auto\";\n\n    let title = document.createElement('h2');\n    title.innerHTML = \"Cells with Accessibility Issues\";\n    title.style.margin = '15px';\n\n    // Alt-text Toggle Button\n    let toggle = document.createElement('div');\n    toggle.style.display = 'flex';\n    toggle.style.alignItems = 'center';\n    toggle.style.margin = '10px';\n\n    let altTextToggle = document.createElement('input');\n    altTextToggle.type = \"checkbox\";\n    altTextToggle.id = \"altTextToggle\";\n    altTextToggle.checked = this._enableAltText;\n\n    let altTextToggleLabel = document.createElement(\"label\");\n    altTextToggleLabel.htmlFor = \"altTextToggle\";\n    altTextToggleLabel.textContent = \"Alt-text auto generation\";\n\n    altTextToggle.addEventListener(\"change\", () => {\n      this._enableAltText = altTextToggle.checked;\n    });\n\n    \n    this.node.appendChild(title);\n\n    toggle.appendChild(altTextToggle);\n    toggle.appendChild(altTextToggleLabel);\n    this.node.appendChild(toggle);\n\n    this.node.appendChild(this._listCells);\n  }\n\n  //add a button that would navigate to the cell having the issue\n  addCell(cellId: string, buttonContent: string, buttonId: string): void {\n    const listItemWrapper = document.createElement('div');\n    // listItemWrapper.id = 'cell-' + cellId + \"_\" + buttonContent;\n    listItemWrapper.id = 'cell-' + cellId + \"_\" + buttonId;\n\n    const listItem = document.createElement('div');\n    listItem.style.display = 'flex';\n    listItem.style.alignItems = 'center';\n    listItem.style.flexWrap = 'nowrap';\n\n    //button\n    const button = document.createElement('button');\n    button.classList.add(\"jp-toast-button\");\n    button.classList.add(\"jp-mod-link\");\n    button.classList.add(\"jp-mod-small\");\n    button.classList.add(\"jp-Button\");\n    button.style.margin = '5px';\n    button.style.marginRight = '5px';\n    button.style.marginLeft = '7px';\n    button.style.flexShrink = '1';\n    button.textContent = buttonContent;\n    \n    button.addEventListener('click', () => {\n      this.scrollToCell(cellId, buttonId, this._enableAltText);\n    });\n\n    //more information icon\n    const infoIcon = document.createElement('span');\n    infoIcon.innerHTML = '&#9432;';\n    infoIcon.style.cursor = 'pointer';\n    infoIcon.style.marginRight = '5px';\n\n    const spinner = document.createElement('div');\n    spinner.id = \"spinner-\" + cellId;\n    spinner.style.display = 'none';\n    spinner.style.height = '50px';\n\n    //alt-text\n    const altTextDiv = document.createElement('div');\n    altTextDiv.style.display = 'none'\n\n    const altTextField = document.createElement('textarea');\n    altTextField.style.display = 'flex';\n    altTextField.style.border = '1px solid black';\n    altTextField.style.margin = '5px';\n    altTextField.style.marginLeft = '10px';\n    altTextField.style.height = '100px';\n    altTextField.style.width = '100%';\n    altTextField.style.flexShrink = '1';\n    altTextField.style.overflow = 'auto';\n    altTextField.value = '';\n    altTextField.style.fontSize = '13px';\n    altTextField.style.fontFamily = \"Arial\";\n\n    const altTextButton = document.createElement('button');\n    altTextButton.classList.add(\"jp-toast-button\");\n    altTextButton.classList.add(\"jp-mod-small\");\n    altTextButton.style.height = '20px';\n    altTextButton.style.margin = '5px';\n    altTextButton.textContent = \"Apply\";\n    altTextButton.addEventListener('click', () => {\n      this.applyAltText(cellId, altTextField.value);\n    });\n\n\n\n    //dropdown box\n    const dropdown = document.createElement('div');\n    dropdown.style.display = 'none';\n    dropdown.style.marginLeft = '50px';\n    dropdown.style.marginRight = '50px';\n    dropdown.style.backgroundColor = 'white';\n    dropdown.style.border = '1px solid black';\n    dropdown.style.padding = '5px';\n    const link = document.createElement('a');\n    if (buttonContent.includes(\"Transparency\")){\n      link.href = \"https://www.w3.org/WAI/WCAG21/Understanding/use-of-color.html\";\n      link.textContent = \"WCAG transparency guidelines\";\n    } else if(buttonContent.includes(\"Heading\")){\n      link.href = \"https://www.w3.org/WAI/tutorials/page-structure/headings/\";\n      link.textContent = \"WCAG headings guidelines\";\n    } else if(buttonContent.includes(\"Alt\")){\n      link.href = \"https://www.w3.org/TR/WCAG20-TECHS/H37.html\";\n      link.textContent = \"WCAG alt-text guidelines\";\n    } else if(buttonContent.includes(\"Contrast\")){\n      link.href = \"https://www.w3.org/WAI/WCAG21/Understanding/contrast-minimum.html\";\n      link.textContent = \"WCAG text color contrast guidelines\";\n    }\n    link.style.color = \"#069\";\n    link.style.textDecoration = \"underline\";\n    \n    link.target = \"_blank\";\n    dropdown.appendChild(link);\n\n    // Toggle dropdown on info icon click\n    infoIcon.addEventListener('click', () => {\n        dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';\n    });\n    \n\n    var add = true;\n    //check if this error already exists in the running map, if so do not add it\n    if (this._cellMap.has(cellId)){\n      var existingList = this._cellMap.get(cellId)\n      existingList!.forEach(b => {          \n        if (b.textContent == buttonContent) {\n          add = false;\n        }\n      })\n\n      existingList!.push(listItemWrapper)\n      this._cellMap.set(cellId, existingList!);\n    } else {\n      this._cellMap.set(cellId, [listItemWrapper]);\n    }\n\n    if (add) {\n      listItem.appendChild(button);\n      listItem.appendChild(infoIcon);\n      listItemWrapper.appendChild(listItem);\n      listItemWrapper.appendChild(dropdown);\n      \n      altTextDiv.appendChild(altTextField);\n      altTextDiv.appendChild(altTextButton);\n      listItemWrapper.appendChild(altTextDiv);\n\n      listItemWrapper.appendChild(spinner);\n      \n      this._listCells.appendChild(listItemWrapper);\n    }\n\n    // this.showOnlyVisibleCells();\n  }\n\n  updateCell(cellId: string, altTextContent: string): void {\n    const listItem = this._cellMap.get(cellId);\n    if (listItem != null) {\n      // Need to change logic so that even if we change the DOM ordering it works properly\n      // Get altTextDiv\n      const altTextDiv = listItem[0].querySelectorAll('div')[2];\n      // Get altTextField\n      const altTextField = altTextDiv.querySelectorAll('textarea')[0];\n      altTextField.value = altTextContent;\n      altTextDiv.style.display = 'flex';\n    }\n  }\n\n  //remove cell from sidebar and from running map\n  removeCell(cellId: string): void {\n    //get list of error buttons related to this cell\n    const listItem = this._cellMap.get(cellId);\n    if (listItem != null) {\n      listItem.forEach((btn) => {\n        for (let item of this._listCells.children) {\n          if (btn.id == item.id) {\n            this._listCells.removeChild(btn);\n          }\n        }\n      });\n    }\n    if(this._cellMap.has(cellId)){\n      this._cellMap.delete(cellId);\n    }\n  }\n\n  applyAltText(cellId: string, altTextContent: string): void {\n\n    const notebookPanel = this._notebookTracker.currentWidget;\n    const notebook = notebookPanel!.content;\n\n    for (let i = 0; i < notebook.widgets.length; i++) {\n      const cell = notebook.widgets[i];\n      if (cell.model.id === cellId) {\n        if (cell.model.type == \"markdown\") {\n          const cellContent = cell.model.sharedModel.getSource();\n          const markdownImgRegex = /!\\[([^\\]]*)?\\]\\((.*?)\\)/g;\n          const htmlImgRegex = /<img\\s+([^>]*?)(?=\\s*src=['\"][^'\"]*['\"][^>]*)([^>]*?)>/g;\n\n          const updatedMDContent = cellContent.replace(markdownImgRegex, (_, altText, url) => {\n            // Set new alt text\n            console.log(`Updating alt text of image: ${url}`);\n            // New lines parsed into MD alt text doesn't render, so remove all new lines\n            altTextContent = altTextContent.replace(/[\\r\\n]+/g, ' ');\n            return `![${altTextContent}](${url})`; \n          });\n          \n          // If content changed, update the cell model\n          if (updatedMDContent !== cellContent) {\n            cell.model.sharedModel.setSource(updatedMDContent);\n          }\n\n          const updatedHTMLContent = cellContent.replace(htmlImgRegex, (match, beforeSrc, afterSrc) => {\n            // Check if the img tag already has an alt attribute\n            if (match.includes('alt=')) {\n                // If alt exists, replace its value\n                return match.replace(/(alt=['\"][^'\"]*['\"])/, `alt=\"${altTextContent}\"`);\n            } else {\n                // If alt does not exist, add it after the src attribute\n                return `<img ${beforeSrc} alt=\"${altTextContent}\" ${afterSrc}>`;\n            }\n          });\n          \n          // If content changed, update the cell model\n          if (updatedHTMLContent !== cellContent) {\n            cell.model.sharedModel.setSource(updatedHTMLContent);\n          }\n        }    \n        // Images generated by external libraries - Currently Working on it \n        else {\n          const markdownCell = {\n            cell_type: 'markdown',\n            metadata: {},\n            source: \"Dynamically added Cell\",\n            trusted: true,\n          };\n          // Somehow crashes\n          notebook.model?.sharedModel.insertCell(0, markdownCell);\n          // notebook.model?.sharedModel.addCell(markdownCell);\n        }\n      }\n    }\n  }\n\n  async generateAltText(imageData: string, cellId: string): Promise<void> {\n    const target = document.getElementById(\"spinner-\" + cellId);\n    if (target) {\n      target.style.display = 'block';\n      const spinner = createSpinner(target);\n      try {\n        const altText = await sendImageToModel(imageData || \" \");\n        this.updateCell(cellId, altText);\n      } catch (error) {\n          console.error(\"Error generating alt text:\", error);\n      } finally {\n          stopSpinner(spinner);\n          target.style.display = 'none';\n      }\n    }\n  }\n\n  //scroll to cell once clicked\n  scrollToCell(cellId: string, buttonId: string, altTextEnabled: boolean): void {\n    const notebookPanel = this._notebookTracker.currentWidget;\n    const notebook = notebookPanel!.content;\n    \n    for (let i = 0; i < notebook.widgets.length; i++) {\n      const cell = notebook.widgets[i];\n      if (cell.model.id === cellId) {\n        cell.node.scrollIntoView({ behavior: 'auto', block: 'center' });\n        \n        //flash the cell in a yellow color briefly when higlighted\n        const originalStyle = cell.node.style.transition;\n        cell.node.style.transition = 'background-color 0.5s ease';\n        cell.node.style.backgroundColor = '#ffff99';\n        setTimeout(() => {\n          cell.node.style.backgroundColor = '';\n          cell.node.style.transition = originalStyle;\n        }, 800);\n\n        // If issue is alt-text\n        if (buttonId == \"alt\") {\n          if (!altTextEnabled) this.updateCell(cell.model.id, \"\");\n          else {\n            const imageSrc = cell.node.querySelector('img')?.src;\n            if (imageSrc) {\n              this.generateAltText(imageSrc, cell.model.id);\n            }\n          }\n        }\n      }\n    }\n  }\n\n  //helper safety method that only shows issued for cells that\n  // are visible ONLY in the currently opened jupyterlab notebook\n  showOnlyVisibleCells(): void {\n    console.log(\"showing only visible cells\");\n    var keyList = Array.from(this._cellMap.keys());\n    const notebookPanel = this._notebookTracker.currentWidget;\n    const notebook = notebookPanel!.content;\n\n    keyList.forEach(k => {\n      var cellExists = false;\n      for (let i = 0; i < notebook.widgets.length; i++) {\n        const cell = notebook.widgets[i];\n        if (cell.model.id === k) {\n          cellExists = true;\n          break\n        }\n      }\n      if(!cellExists){\n        this.removeCell(k);\n      }\n    });\n  }\n}\n\nexport default plugin;\n"],"names":[],"sourceRoot":""}